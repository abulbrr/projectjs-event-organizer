<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <title>Events</title>
    <script src="./LocalStorage.js"></script>
    <script src="./HTMLCreator.js"></script>

</head>

<body>
    <nav>
        <div class="nav-wrapper green">
            <a href="./Events.html" class="brand-logo center">projectjs-event-organizer</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li>
                    <a href="./createEvent.html">Create Event</a>
                </li>
                <li>
                    <a onClick="LocalStorage.logout()">
                        <i class="material-icons right">person_outline</i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <h2>Events</h2>
        <ul id="Events" class="collection">

        </ul>

    </div>


    <script>
        var EventsList = JSON.parse(localStorage.getItem('EventsList'));

        for (var i = 0; i < EventsList.length; ++i) {
            createEventTemplate(EventsList[i], i)
        }

        console.log('EventsList: ', EventsList);
        function $(element) {
            return document.querySelector(element);
        }
        function createEventTemplate(element, index) {

            $("#Events").innerHTML += "<li id='li" + index + "' class='collection-item'></>"

            HTMLCreator.createElement({ type: "h4", text: "Name: " + element.name }, document.querySelector('#li' + index));
            HTMLCreator.createElement({ type: "p", text: "id: " + element.uuid }, document.querySelector('#li' + index));
            HTMLCreator.createElement({ type: "p", text: "is NSFW: " + element.isNsfw }, document.querySelector('#li' + index));
            $("#li" + index).innerHTML += "<button id='" + element.uuid + "' onclick='removeItem(this.id)' class='material-icons'>delete</button>" +
                "<button id='" + element.uuid + "' onclick='AddClientToEvent(this.id)' class='material-icons'>event_available</button>< ul id = 'dropdown1' class='dropdown-content' >"
                console.log(element.atendees)
                CollectionUtils.forEach( element.atendees, (client)=> {
                    $("#li" + index).innerHTML += "<li><a>"+ client.name+"</a></li>"
                })
                    
                "</ul >"
        }



        function removeItem(uuid) {
            LocalStorage.removeEvent(uuid, () => {
                alert("deleting items: sucess")
                window.location.reload(true);

            })
        }

        function AddClientToEvent(eventUuid) {
            if (!LocalStorage.isUserLoggedIn()) {
                window.location.href = "./login.html"
                return
            }

            let user = LocalStorage.getLoggedInUser();

            if (user = undefined) {
                alert("problem getting the user")
                return
            }

            LocalStorage.addClientToEvent(user, eventUuid)





        }


    </script>
</body>

</html>