<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <title>Events</title>
    <script src="./LocalStorage.js"></script>
    <script src="./HtmlCreator.js"></script>

</head>

<body>
    <nav>
        <div class="nav-wrapper green">
            <a href="./Events.html" class="brand-logo center">projectjs-event-organizer</a>
            <ul id="nav-mobile" class="right">
                <li>
                    <a href="./createEvent.html">Create Event</a>
                </li>
                <li>
                    <a onClick="LocalStorage.logout()">
                        <i class="material-icons right">person_outline</i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <h2>Events</h2>
        <ul id="Events" class="collection">

        </ul>

    </div>


    <script>
        var EventsList = LocalStorage.getEvents();

        // console.log(EventsList)
        // CollectionUtils.forEach( EventsList, (element, i) => { 
        //     renderEvent(element, i)
        //  })

         for (let index = 0; index < EventsList.length; index++) {
             const event = EventsList[index];
             renderEvent(event, index)
             
         }

        console.log('EventsList: ', EventsList);
        function $(query) {
            return document.querySelector(query);
        }

        function renderEvent(event, index) {

            const card = HtmlCreator.createElement('div', {class: 'card'})
            const cardContent = HtmlCreator.createElement('div', {class: 'card-content'})
            const li = HtmlCreator.createElement( 'li', {id: 'li' + index, class: 'collection-item'})

            $('#Events').appendChild(card)
            card.appendChild(cardContent)
            cardContent.appendChild(li)

            li.appendChild( HtmlCreator.createElement('h4', {}, "Name: "+ event.name) )
            li.appendChild( HtmlCreator.createElement('p', {}, "id: "+ event.uuid) )
            li.appendChild( HtmlCreator.createElement('p', {}, "is nsfw: "+ event.isNsfw) )

            li.appendChild( HtmlCreator.createElement('button', {
                        eventId: event.uuid,
                        onClick: 'removeItem(eventId)',
                        class: 'material-icons'  },
                        'delete'))
            
            li.appendChild( HtmlCreator.createElement('button', {
            eventId: event.uuid,
            onClick: 'AddClientToEvent(this.eventId)',
            class: 'material-icons'  },
            'event_available'))
                    
        }



        function removeItem(uuid) {
            LocalStorage.removeEvent(uuid, () => {
                alert("deleting items: sucess")
                window.location.reload(true);

            })
        }

        function AddClientToEvent(eventUuid) {
            if (!LocalStorage.isUserLoggedIn()) {
                window.location.href = "./login.html"
                return
            }

            let user = LocalStorage.getLoggedInUser();

            if (user == undefined) {
                alert("problem getting the user")
                return
            }
            console.log('add client to event')
            console.log(user)
            LocalStorage.addClientToEvent(user, eventUuid)





        }


    </script>
</body>

</html>